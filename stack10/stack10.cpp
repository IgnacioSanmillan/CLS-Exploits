// ConsoleApplication1.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"
#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include <windows.h>

void * buf1;
FILE *f1;
struct MyStruct
{
	char * p_size;
	char size ;
	int leidos ;
	int maxsize ;
	int(*foo2)(char *);
	void * buf2;

};
void check(MyStruct valores);

int main(int argc, char *argv[])
{
		MyStruct valores;
		valores.maxsize = 50;
		valores.leidos = 0;
		valores.size = 0;

		/* Apertura del fichero original, para lectura en binario*/
		f1 = fopen("fichero.dat", "rb");
		if (f1 == NULL)
		{
			perror("No se puede abrir fichero.dat");
			return -1;
		}

		 fread(&valores.size, 1, 1, f1);


		if (valores.size > valores.maxsize)
		{
			perror("Nos fuimos al carajo\n");
			return -1;


		}
		printf("%08x size :%08x\n", valores.size);

		//__debugbreak();

		valores.p_size = &valores.size;
		valores.foo2 = (int(*)(char *))&system;

		valores.buf2 = malloc(50);
		buf1 = valores.buf2;
		check(valores);
		
		return 0;
	
}

	void check(MyStruct _valores)
	{
		char buf[50];

		fread(&buf, 1,* _valores.p_size, f1);
		memcpy(buf1, buf, 50);


		return;

	}


   

